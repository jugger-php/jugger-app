Идеальная структура:
Точка входа - приложение - результат

В разрезе web приложения, это:
запрос - обработчик - ответ

Все внутреннее состояние сервера должно содержаться в объекте запроса, а все изменения состояния должны хранится в объекте ответ (при отправке ответа, все сессии и куки будут установлены, при возникновении ошибки, нужно также сохранять внутренне состояние (сессия).

Чтобы приложение не имело побочных эффектов и все можно было оттестировать, нужно исключить обращение к глобальным переменным (post, get, server, session, cookie).

Для удобства, все внутренние состояния нужно вынести в отдельный объект - контекст (отправлять в обработчик его нужно как часть запроса, и также все изменения возвращать в качестве части ответа).

Каждый обработчик - должен быть определенного типа:
- QueryAction - запрос, должен вернуть данные: QueryResponse
- CommandAction - действие, должен вернуть статус операции (без данных): CommandResponse

В каждый Action отправляется также DI контейнер, который содержит всех обработчиков.

С учётом описанных правок, порядок выглядит так:
1. Инициализация di контейнера
2. Инициализация request объекта
3. Инициализация обработчика
4. Получение response
5. Отправка response

3 пункт должен также содержать роутер (при этом роутер получается из di контейнера, те в ядре должен быть обьявлен и использоваться только интерфейс).

Таким образом алгоритм такой:
1. Инициализация di контейнера
2. Инициализация request объекта
3. Инициализация роутера
4. Получение обработчика (в роутер отправляется Request)
5. Получение response
6. Отправка response

структура:
- index.php
- .htaccess
- app
- public

Мтруктура
